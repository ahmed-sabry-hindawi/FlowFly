<div class="col-12 row" style="z-index: 10;float: right;">
  <div class="alert alert-danger response-message" *ngIf="errorMessage">
    <p>
      {{ errorMessage }}<mat-icon>cancel</mat-icon>
    </p>
  </div>
  <div class="alert alert-success response-message" *ngIf="successMessage">

    <p>
      {{ successMessage }} <mat-icon>check_circle</mat-icon>
    </p>
  </div>
</div>
<br />
<div class="row col-12">

  <div class="form-control" style="background-color: #f9f9f9;margin-bottom: 30px;">
    <h1 class="modal-h1-header">
      إنشاء نموذج تقديم طلب لخدمة {{ serviceDetails.name}}
    </h1>
  </div>
  <mat-stepper orientation="horizontal" (selectionChange)="showFormReview($event)" #stepper>
    <mat-step [stepControl]="firstFormGroup">

      <form [formGroup]="firstFormGroup">
        <ng-template matStepLabel>
          <span class="form-stepper-header">
            ادخل بيانات النموذج

          </span>
        </ng-template>
        <br />
        <div class="row col-12">
          <div class="col-8">
            <mat-card>
              <mat-card-header>
                <h3 class="section-header">بيانات النموذج </h3><br />
              </mat-card-header>
              <mat-card-actions>
                <div class="row col-12">
                  <div class="col-6">
                    <div class="row col-12 control ">
                      <div class="col-4 control-header">اسم الخدمة</div>
                      <div class="col-8 control-data">{{ serviceDetails.name}}</div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="row col-12 control">
                      <div class="col-4 control-header">اسم النموذج</div>
                      <div class="col-8 control-data"><input class="form-control" type="text" formControlName="name"  [readonly]='true' />
                        <!-- <div *ngIf="firstFormGroup.value.name !=''" style="color: green;font-size: small;">اسم النموذج
                          لايظهر للمستخدمين</div> -->
                      </div>
                    </div>
                  </div>
                </div>
              </mat-card-actions>
              <mat-card-actions>
                <div formArrayName="addedControls" style="width: 100%;">

                  <mat-card-header>
                    <h3 class="section-header">الحقول المضافة </h3>
                    <br />

                  </mat-card-header>


                  <div class="grid" style="width: 100%;height: 100%;" *ngIf="getControls().length>0">

                    <mat-card *ngFor="let newControl of getControls();let i = index" class="grid-card">
                      <ng-container [formGroup]="newControl">
                        <div style="text-align: center;font-family: 'Bahij';">
                          <div class="col-md-12 row" style="padding: 5px;margin: 5px;">

                            <div class="col-1">
                              <mat-icon (click)="deleteElementType(i)" class="close">close</mat-icon>
                            </div>
                            <div class="col-11">
                              <mat-label class="field-lable">
                                {{newControl.get('elementTypeName')?.value}}

                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==1"
                                  style="vertical-align: top;">edit</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==2"
                                  style="vertical-align: top;">arrow_drop_down_circle</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==3"
                                  style="vertical-align: top;">radio_button_checked</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==4"
                                  style="vertical-align: top;">check_box</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==5"
                                  style="vertical-align: top;">attach_file</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==6"
                                  style="vertical-align: top;">wrap_text</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==7"
                                  style="vertical-align: top;">calendar_today</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==8"
                                  style="vertical-align: top;">person_add</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==9"
                                  style="vertical-align: top;">filter_1</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==10"
                                  style="vertical-align: top;">date_range</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==11"
                                  style="vertical-align: top;">perm_media</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==12"
                                  style="vertical-align: top;">notes</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==13"
                                  style="vertical-align: top;">star_half</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==14"
                                  style="vertical-align: top;">move_to_inbox</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==15"
                                  style="vertical-align: top;">arrow_drop_down_circle</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==16"
                                  style="vertical-align: top;">radio_button_checked</mat-icon>
                                <mat-icon *ngIf="newControl.get('elementTypeID')?.value==17"
                                  style="vertical-align: top;">check_box</mat-icon>
                              </mat-label>
                            </div>
                          </div>


                        </div>
                        <input type="hidden" formControlName="elementTypeID" />
                        <mat-form-field>
                          <mat-label class="field-lable">عنوان الحقل</mat-label>
                          <input matInput formControlName="title" class="form-control field-lable" required="required"
                            maxlength="50">
                        </mat-form-field>
                        <section>
                          <mat-checkbox color="primary" formControlName="isMandatory">
                            <span style="color: #fa0123;">
                              الحقل مطلوب
                            </span>
                          </mat-checkbox>
                        </section>
                        <ng-container
                          *ngIf="newControl.get('elementTypeID')?.value==2 || newControl.get('elementTypeID')?.value==3 || newControl.get('elementTypeID')?.value==4">
                          <mat-form-field>
                            <mat-label class="field-lable">اختر مصدر البيانات</mat-label>
                            <mat-select formControlName="dataSourceID" class="field-lable" required="required">
                              <mat-option class="field-lable" *ngFor="let ds of allDataSources" [value]="ds.id">
                                {{ ds.arName }}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                          <div *ngIf="newControl.get('dataSourceID')?.value===null" style="color: red;">مصدر البيانات
                            مطلوب</div>
                        </ng-container>
                        <ng-container *ngIf="newControl.get('elementTypeID')?.value==14">
                          <mat-form-field>
                            <mat-label class="field-lable">اختر مصدر البيانات</mat-label>
                            <mat-select formControlName="externalDataSourceID" class="field-lable" required="required">
                              <mat-option class="field-lable" *ngFor="let ds of externalDataSources_GetValue"
                                [value]="ds.id">
                                {{ ds.name }}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                          <div *ngIf="newControl.get('externalDataSourceID')?.value===null" style="color: red;">مصدر
                            البيانات
                            مطلوب</div>
                        </ng-container>
                        <ng-container
                          *ngIf="newControl.get('elementTypeID')?.value==15 || newControl.get('elementTypeID')?.value==16 || newControl.get('elementTypeID')?.value==17">
                          <mat-form-field>
                            <mat-label class="field-lable">اختر مصدر البيانات</mat-label>
                            <mat-select formControlName="externalDataSourceID" class="field-lable" required="required">
                              <mat-option class="field-lable" *ngFor="let ds of externalDataSources_GetList"
                                [value]="ds.id">
                                {{ ds.name }}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                          <div *ngIf="newControl.get('externalDataSourceID')?.value===null" style="color: red;">مصدر
                            البيانات
                            مطلوب</div>
                        </ng-container>
                      </ng-container>
                    </mat-card>
                  </div>
                </div>
              </mat-card-actions>
              <mat-card-subtitle class="field-lable" style="text-align: center;"> اضغط + لإضافة حقل
                جديد</mat-card-subtitle>
              <mat-card-actions>
                <mat-card
                  style="background-color: #b3daf5;width: 100%;align-items: center;padding: 10px;border-radius: 10px;">
                  <button mat-fab color="primary" title="إضافة حقل" [matMenuTriggerFor]="menu_formElementsTypes">
                    <mat-icon>add</mat-icon>
                  </button>
                  <mat-menu #menu_formElementsTypes="matMenu" [overlapTrigger]="true">
                    <div *ngFor="let elementType of allElementsTypes" (click)="AddElementType(elementType.id)"
                      mat-menu-item>
                      <p>
                        <mat-icon *ngIf="elementType.id==1" style="vertical-align: top;">edit</mat-icon>
                        <mat-icon *ngIf="elementType.id==2"
                          style="vertical-align: top;">arrow_drop_down_circle</mat-icon>
                        <mat-icon *ngIf="elementType.id==3" style="vertical-align: top;">radio_button_checked</mat-icon>
                        <mat-icon *ngIf="elementType.id==4" style="vertical-align: top;">check_box</mat-icon>
                        <mat-icon *ngIf="elementType.id==5" style="vertical-align: top;">attach_file</mat-icon>
                        <mat-icon *ngIf="elementType.id==6" style="vertical-align: top;">wrap_text</mat-icon>
                        <mat-icon *ngIf="elementType.id==7" style="vertical-align: top;">calendar_today</mat-icon>
                        <mat-icon *ngIf="elementType.id==8" style="vertical-align: top;">person_add</mat-icon>
                        <mat-icon *ngIf="elementType.id==9" style="vertical-align: top;">filter_1</mat-icon>
                        <mat-icon *ngIf="elementType.id==10" style="vertical-align: top;">date_range</mat-icon>
                        <mat-icon *ngIf="elementType.id==11" style="vertical-align: top;">perm_media</mat-icon>
                        <mat-icon *ngIf="elementType.id==12" style="vertical-align: top;">notes</mat-icon>
                        <mat-icon *ngIf="elementType.id==13" style="vertical-align: top;">star_half</mat-icon>
                        <mat-icon *ngIf="elementType.id==14" style="vertical-align: top;">move_to_inbox</mat-icon>
                        <mat-icon *ngIf="elementType.id==15" style="vertical-align: top;">arrow_drop_down_circle</mat-icon>
                        <mat-icon *ngIf="elementType.id==16" style="vertical-align: top;">radio_button_checked</mat-icon>
                        <mat-icon *ngIf="elementType.id==17" style="vertical-align: top;">check_box</mat-icon>

                        {{elementType.arName}}
                      </p>
                    </div>
                  </mat-menu>
                </mat-card>

              </mat-card-actions>
              <mat-card-actions>
                <div class="col-12" style="text-align: left !important;">
                  <button class="btn btn-primary field-lable"
                    [disabled]="firstFormGroup.status != 'VALID' || getControls().length==0"
                    matStepperNext>التالي<mat-icon>navigate_before</mat-icon></button>
                </div>
              </mat-card-actions>
            </mat-card>
          </div>
          <div class="col-4" style="text-align: center;">
            <div class="card blue-card">
              صمم نموذج الخدمة باختيار العناصر والحقول التي تناسب أعمالك
            </div>
            <div class="row svg-limited">
              <img src="/assets/images/visual-collaboration.svg">
            </div>
          </div>
        </div>


        <br />
      </form>
    </mat-step>
    <mat-step [stepControl]="secondFormGroup">
      <form [formGroup]="secondFormGroup">
        <ng-template matStepLabel>
          <span class="form-stepper-header">
            ادخل اعتمادات الطلب
          </span>
        </ng-template>
        <br />
        <div class="row">

          <div class="col-8">
            <mat-card style="width: 100%;align-self: center;">
              <mat-card-header>
                <h3 class="section-header">اعتمادات الخدمة</h3>
              </mat-card-header>

              <mat-card-actions>
                <mat-card class="request-flow-apply">
                  <p style="font-weight: bold;padding-top: 10px;border-radius: 10px;"><mat-icon
                      style="vertical-align: bottom !important;">send</mat-icon> تقديم الطلب </p>
                </mat-card>
              </mat-card-actions>

              <div cdkDropList cdkDropListOrientation="vertical" (cdkDropListDropped)="drop($event)">
                <mat-card-actions *ngFor="let phase of addedPhases" style="width: 100%;margin: 0px;">
                  <mat-card class="grid-card" cdkDrag [ngClass]="phase.styleClass">
                    <div class="col-md-12 row">
                      <div class="col-1" style="text-align: right;">
                        <mat-icon (click)="deletePhase(phase)" class="close">close</mat-icon>
                      </div>
                      <div class="col-10" style="align-self: center;">
                        <p style="font-weight: bold;padding-top: 10px;text-align: center;"><mat-icon
                            style="vertical-align: bottom !important;">group</mat-icon> {{phase.name}} </p>
                      </div>
                      <div class="col-1" style="text-align: left;">
                      </div>
                    </div>
                    <div class="col-md-12 row">
                      <div class="col-5">
                        <h3 style="text-align: right;font-family: 'Bahij';">
                          {{getPhaseName(phase.approvalTypeID)}}</h3>
                        <p *ngIf="phase.approvalTypeID==1">اعتماد من نوع مجموعة : {{ getGroupName(phase.groupID) }} </p>
                        <p *ngIf="phase.approvalTypeID==2">اعتماد من نوع الإدارة : {{ getDepartmentName(phase.departmentID) }} </p>
                        <p *ngIf="phase.approvalTypeID==8">الخدمة : {{ getEndPointName(phase.endPointId) }} </p>
                      </div>
                      <div class="col-6">

                      </div>
                      <div class="col-1">
                        <mat-icon style="cursor:move;">open_with</mat-icon>
                      </div>
                    </div>
                    <div class="col-md-12 row" style="padding: 10px;" *ngIf="phase.approvalTypeID!=8">

                      <div class="col-11">
                        <h3 style="text-align: right;font-family: 'Bahij';">
                          خيارات المعتمد
                        </h3>
                        <ng-container *ngFor="let dicisionType of allDecisionsTypes">
                          <ng-container *ngIf="dicisionType.id !=5">
                            <button mat-stroked-button (click)="RemoveDecisionOption(dicisionType.id,phase.name)"
                              *ngIf="existInThePhase(dicisionType.id,phase.name)" color="primary" class="field-lable">{{
                              dicisionType.arName}}
                              <mat-icon *ngIf="dicisionType.id !=1">delete</mat-icon>
                            </button>
                            <button mat-stroked-button (click)="AddDecisionOption(dicisionType.id,phase.name)"
                              *ngIf="!existInThePhase(dicisionType.id,phase.name)" class="field-lable">{{
                              dicisionType.arName}}
                              <mat-icon>add</mat-icon>
                            </button>

                          </ng-container>
                        </ng-container>
                      </div>

                      <div class="col-1">

                      </div>
                    </div>
                  </mat-card>
                </mat-card-actions>
              </div>
              <mat-card-subtitle class="field-lable" style="text-align: center;">اضغط + لإضافة مرحلة
                اعتماد</mat-card-subtitle>
              <mat-card-actions>
                <mat-card
                  style="background-color: #b3daf5;width: 100%;align-items: center;padding: 10px;border-radius: 10px;">
                  <button mat-fab color="primary" title="إضافة مرحلةاعتماد" (click)="openAddApprovalPhaseModal()">
                    <mat-icon>add</mat-icon>
                  </button>
                </mat-card>
              </mat-card-actions>
              <mat-card-actions>

                <mat-card class="request-flow-completed">
                  <p style="font-weight: bold;padding-top: 10px;"><mat-icon
                      style="vertical-align: bottom !important;">done</mat-icon> اكتمال الطلب </p>
                </mat-card>
              </mat-card-actions>
              <mat-card-actions>

                <div class="col-12 row">
                  <div class="col-6" style="text-align: right !important;">
                    <button class="btn btn-primary" matStepperPrevious><mat-icon>navigate_next</mat-icon>السابق</button>
                  </div>
                  <div class="col-6" style="text-align: left !important;">
                    <button class="btn btn-primary" matStepperNext>
                      التالي
                      <mat-icon>navigate_before</mat-icon></button>
                  </div>
                </div>
              </mat-card-actions>

            </mat-card>

          </div>
          <div class="col-4" style="vertical-align: middle;text-align: left;">
            <br /><br />
            <img src="/assets/images/workflow.svg" style="width: 80%;">
          </div>
        </div>
      </form>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>
        <span class="form-stepper-header">
          مراجعة وإرسال
        </span>
      </ng-template>
      <br />
      <div *ngIf="!isLoading">
        <h3 class="section-header">شكل النموذج كما يظهر للمستخدم</h3>
        <br />
        <div class="row col-12">
          <div class="col-9">
            <div class="col-xs-12 form-bordered card shadow-lg border-0 rounded-lg mt-5" *ngIf="FormCompleted">
              <br />
              <div class="form-control" style="background-color: #f9f9f9;">
                <h1 class="modal-h1-header">طلب {{serviceDetails.name}}</h1>
              </div>
              <br />
              <div class="card">
                <br />
                <h3 class="section-header">
                  بيانات مقدم الطلب</h3>

                <div class="row col-12">
                  <div class="col-6">
                    <div class="row col-12 control ">
                      <div class="col-4 control-header">مقدم الطلب</div>
                      <div class="col-8 control-data">خالد طربوش</div>
                    </div>

                  </div>
                  <div class="col-6">
                    <div class="row col-12 control">
                      <div class="col-4 control-header">رقمه</div>
                      <div class="col-8 control-data">55</div>
                    </div>
                  </div>
                </div>
                <div class="row  col-12">
                  <div class="col-6">
                    <div class="row col-12 control">
                      <div class="col-4 control-header">الجنسية</div>
                      <div class="col-8 control-data">سوريا</div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="row col-12 control">
                      <div class="col-4 control-header">الجنس</div>
                      <div class="col-8 control-data">ذكر</div>
                    </div>
                  </div>
                </div>

                <div class="row  col-12">
                  <div class="col-6">
                    <div class="row col-12 control">
                      <div class="col-4 control-header">الإدارة</div>
                      <div class="col-8 control-data">الإدارة التقنية
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="row col-12 control">
                      <div class="col-4 control-header">المسمى</div>
                      <div class="col-8 control-data">مبرمج</div>
                    </div>
                  </div>
                </div>
              </div>
              <br />
              <div class="card">

                <br />
                <h3 class="section-header">
                  حقول الطلب</h3>
                <div class="small-grid" *ngIf="controlsToDraw !=undefined && controlsToDraw.length>0">
                  <mat-card *ngFor="let newControl2 of controlsToDraw;let i = index"
                    style="width: 100% !important;border: 0;height: 100%;padding: 10px;margin: 10px;">
                    <ng-container [formGroup]="newControl2">
                      <div style="text-align: center;font-family: 'Bahij';">

                        <mat-label class="field-lable form-floating mb-3 col-md-126">
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==1">
                            <div class="row col-12 control ">

                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">edit</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <input class="form-control" type="text" disabled="disabled" value="حقل نصي" />
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==2">
                            <div class="row col-12 control ">

                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">arrow_drop_down_circle</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <mat-select class="field-lable form-control" color="primary">
                                  <mat-option selected>اختر</mat-option>
                                  <mat-option class="field-lable"
                                    *ngFor="let ds of getAssignedDataSource(newControl2.get('dataSourceID')?.value)">
                                    {{ds.arName }}</mat-option>
                                </mat-select>
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==3">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">radio_button_checked</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <mat-radio-group aria-label="اختر" class="field-lable" color="primary">
                                  <mat-radio-button class="field-lable"
                                    *ngFor="let ds of getAssignedDataSource(newControl2.get('dataSourceID')?.value)">
                                    {{ds.arName }}</mat-radio-button>
                                </mat-radio-group>
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==4">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">check_box</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <section>
                                  <mat-checkbox class="field-lable"
                                    *ngFor="let ds of getAssignedDataSource(newControl2.get('dataSourceID')?.value)">
                                    {{ds.arName }}
                                  </mat-checkbox>
                                </section>
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==5">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">attach_file</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <input class="form-control" type="file" disabled="disabled" value="إرفاق ملف" />
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==6">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">wrap_text</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <textarea class="form-control" disabled="disabled" rows="2">نص كبير</textarea>
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==7">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">calendar_today</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <input class="form-control" type="text" disabled="disabled" value="22-02-2022" />
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==8">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">person_add</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <input class="form-control" type="text" disabled="disabled"
                                  value="أحمد علي عبدالمجيد" />
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==9">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">filter_1</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <input class="form-control" type="text" disabled="disabled" value="123" />
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==10">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">date_range</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <input class="form-control" type="text" disabled="disabled"
                                  value="02-02-2022 04-02-2022" />
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==11">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">perm_media</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <input class="form-control" type="file" disabled="disabled" value="إرفاق صورة" />
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==12">
                            <div class="row col-12 control ">
                              <div class="col-12 control-header">
                                <mat-icon style="vertical-align: top;">notes</mat-icon>
                                {{newControl2.get('title')?.value}}
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==13">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">star_half</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <ngb-rating [max]=5 [(rate)]="starRating"></ngb-rating>
                              </div>
                            </div>
                          </ng-container>

                       
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==14">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">move_to_inbox</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <input class="form-control" type="text" disabled="disabled" value="123" />
                              </div>
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==15">
                            <div class="row col-12 control ">

                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">arrow_drop_down_circle</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <mat-select class="field-lable form-control" color="primary">
                                  <mat-option selected>اختر</mat-option>
                                  <mat-option class="field-lable">خيار 1</mat-option>
                                  <mat-option class="field-lable">خيار 2</mat-option>
                                  <mat-option class="field-lable">خيار 3</mat-option>
                                </mat-select>
                              </div>
                            </div>
                            <div>
                              سيتم استرجاع البيانات من خلال الاتصال بالخدمة : 
                              {{this.getExternalDataSourceName_listSources(newControl2.get('externalDataSourceID')?.value)}}
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==16">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">radio_button_checked</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>
                              <div class="col-8 control-data">
                                <mat-radio-group aria-label="اختر" class="field-lable" color="primary">
                                  <mat-radio-button class="field-lable">خيار 1</mat-radio-button>
                                  <mat-radio-button class="field-lable">خيار 2</mat-radio-button>
                                </mat-radio-group> 
                              </div>
                            </div>
                            <div>
                              سيتم استرجاع البيانات من خلال الاتصال بالخدمة : 
                              {{this.getExternalDataSourceName_listSources(newControl2.get('externalDataSourceID')?.value)}}
                            </div>
                          </ng-container>
                          <ng-container *ngIf="newControl2.get('elementTypeID')?.value==17">
                            <div class="row col-12 control ">
                              <div class="col-4 control-header">
                                <mat-icon style="vertical-align: top;">check_box</mat-icon>
                                {{newControl2.get('title')?.value}}<span style="color: #fa0123;"
                                  *ngIf="newControl2.get('isMandatory')?.value">
                                  *</span>
                              </div>    
                              <div class="col-8 control-data">

                                <section>
                                  <mat-checkbox class="field-lable">خيار 1</mat-checkbox>
                                  <mat-checkbox class="field-lable">خيار 2</mat-checkbox>
                                  <mat-checkbox class="field-lable">خيار 3</mat-checkbox>
                                </section>
                              </div>                             
                            </div>
                            <div>
                              سيتم استرجاع البيانات من خلال الاتصال بالخدمة : 
                              {{this.getExternalDataSourceName_listSources(newControl2.get('externalDataSourceID')?.value)}}
                            </div>
                          </ng-container>
                        </mat-label>
                      </div>
                    </ng-container>
                  </mat-card>
                </div>
                <br /><br />
              </div>
              <br />
              <div class="card">
                <br />

                <mat-card style="width: 100% !important;border: 0px;height: 100%;">
                  <h3 class="section-header">
                    اعتمادات الخدمة</h3>
                  <mat-card-actions>
                    <mat-card class="request-flow-apply">
                      <p style="font-weight: bold;padding-top: 10px;"><mat-icon
                          style="vertical-align: bottom !important;">send</mat-icon> تقديم الطلب </p>
                    </mat-card>
                  </mat-card-actions>
                  <mat-card-actions *ngFor="let phase of addedPhases" style="width: 100%;margin: 0px;">
                    <mat-card class="grid-card" [ngClass]="phase.styleClass">
                      <div class="col-md-12 row">
                        <div class="col-1" style="text-align: right;">
                          <mat-icon>group</mat-icon>
                        </div>
                        <div class="col-10" style="align-self: center;">
                          <p style="font-weight: bold;padding-top: 10px;text-align: center;"> {{phase.name}} </p>
                        </div>
                        <div class="col-1" style="text-align: left;">

                        </div>
                      </div>
                      <div class="col-md-12 row">
                        <div class="col-5">
                          <h3 style="text-align: right;font-family: 'Bahij';">اعتماد من نوع
                            {{getPhaseName(phase.approvalTypeID)}}</h3>
                          <p *ngIf="phase.approvalTypeID==1">مجموعة : {{ getGroupName(phase.groupID) }} </p>
                          <p *ngIf="phase.approvalTypeID==2">الإدارة : {{ getDepartmentName(phase.departmentID) }}
                          </p>
                        </div>
                        <div class="col-7">

                        </div>

                      </div>
                    </mat-card>
                  </mat-card-actions>


                  <mat-card-actions>

                    <mat-card class="request-flow-completed">
                      <p style="font-weight: bold;padding-top: 10px;"><mat-icon
                          style="vertical-align: bottom !important;">done</mat-icon> اكتمال الطلب </p>
                    </mat-card>
                  </mat-card-actions>
                </mat-card>




              </div>
              <div class="d-flex align-items-center justify-content-between mt-4 mb-0"
                style="text-align: left !important;">
                <button class="btn btn-primary field-lable" disabled="disabled">إرسال <mat-icon>send</mat-icon></button>
                <button class="btn btn-primary field-lable" disabled="disabled">رجوع
                  <mat-icon>arrow_back</mat-icon></button>
              </div>
              <br />
            </div>

          </div>

          <div class="col-3" style="text-align: center;">
            <div class="row col-12">
              <div class="row">
                <div class="card blue-card">

                  <span style="font-weight: bold; font-family: 'Bahij';">وصف الخدمة</span><br />
                  {{ serviceDetails.description}}

                </div>
              </div><br />
              <div class="row svg-limited">
                <img src="/assets/images/website-maintenance.svg">
              </div>
              <br />

            </div>
          </div>
        </div>
        <div class="col-xs-12 col-md-6 " *ngIf="isLoading" style="text-align: center;align-self: center;">
          <br /><br />
          <app-loading-spinner></app-loading-spinner>
        </div>
        <br />
        <div class="row col-12">
          <div class="col-6" style="text-align: right !important;">
            <button class="btn btn-primary" matStepperPrevious><mat-icon>navigate_next</mat-icon>السابق</button>
          </div>
          <div class="col-6" style="text-align: right !important;">
            {{ errorMessage }}
            <button class="btn btn-primary DecisionButton" (click)="saveForm(stepper,false)">حفظ النموذج  <mat-icon>save</mat-icon></button>
            <button class="btn btn-success DecisionButton" (click)="saveForm(stepper,true)">إطلاق الخدمة <mat-icon>flight_takeoff</mat-icon></button>
            <button mat-button (click)="stepper.reset()">إعادة الضبط</button>
          </div>

        </div>
        <br />
      </div>
      <div class="col-xs-12" *ngIf="isLoading" style="text-align: center;align-self: center;">
        <br /><br />
        <img src="/assets/images/SwallowCatch.png">
        <br /><br /> <br /><br />
        <app-loading-spinner></app-loading-spinner>
      </div>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>
        <span class="form-stepper-header">
          اكتمال النموذج
        </span>
      </ng-template>
      <div style="width: 100%; text-align: center;">
        <br /><br /><br />
        <div class="row col-12" style="min-width: 500px;min-height: 300px;">
          <div class="col-4"></div>
          <div class="col-2 done-bg"></div>
          <div class="col-3">
            <h1>
              تم إنشاء النموذج بنجاح
            </h1>
          </div>
          <div class="col-3"></div>
        </div>
        <br />
      </div>
    </mat-step>
  </mat-stepper>
</div>

<div class="row justify-content-center">
  <div class="col-lg-5 modal" id="model_AddApprovalPhase" style="display:none;">
    <br />
    <div class="modal-content" style="width: 50%;">
      <span (click)="closeAddApprovalPhaseModal()" class="close">&times;</span>

      <div class="form-control" style="background-color: #f9f9f9;">
        <h3 class="modal-h1-header">إضافة مرحلة اعتماد</h3>

      </div>
      <br />
      <div class="card-body" *ngIf="!isLoading">
        <form [formGroup]="approvalPhaseForm" (ngSubmit)="onAddApprovalPhase()">
          <div class="form-group row">
            <div class="form-floating mb-3 col-md-126">
              <input class="form-control" autocomplete="off" formControlName="name" id="name" type="text"
                [required]="true" />
              <label for="name">اسم مرحلة الاعتماد</label>
              <div *ngIf="approvalPhaseForm.controls['name']!=undefined &&
               !approvalPhaseForm.controls['name'].valid &&
                (approvalPhaseForm.controls['name']?.touched || approvalPhaseForm.controls['ApprovalTypeID']?.touched)"
                style="color: red;">اسم مرحلة الاعتماد مطلوب</div>
            </div>

          </div>
          <div class="form-group row" id="divGroups">
            <div class="form-floating mb-3 col-md-6">
              <mat-form-field style="width: 100%;">
                <mat-label class="field-lable">نوع المرحلة</mat-label>
                <mat-select formControlName="ApprovalTypeID" class="field-lable" required>
                  <mat-option class="field-lable" *ngFor="let type of allApprovalTypes" [value]="type.id">{{
                    type.arName }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="form-floating mb-3 col-md-6" *ngIf="approvalPhaseForm.controls['ApprovalTypeID'].value === 1">
              <mat-form-field style="width: 100%;">
                <mat-label class="field-lable">اختر مجموعة الاعتماد</mat-label>
                <mat-select formControlName="groupID" class="field-lable"
                  [required]="approvalPhaseForm.controls['ApprovalTypeID'].value === 1">
                  <mat-option class="field-lable" *ngFor="let group of allGroups" [value]="group.id">
                    {{ group.arName }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="form-floating mb-3 col-md-6" *ngIf="approvalPhaseForm.controls['ApprovalTypeID'].value === 2">
              <mat-form-field style="width: 100%;">
                <mat-label class="field-lable">اختر الإدارة</mat-label>
                <mat-select formControlName="departmentID" class="field-lable"
                  [required]="approvalPhaseForm.controls['ApprovalTypeID'].value == 2">
                  <mat-option class="field-lable" *ngFor="let department of allOSDepartments"
                    [value]="department.departmentId">{{
                    department.departmentName }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="form-floating mb-3 col-md-6" *ngIf="approvalPhaseForm.controls['ApprovalTypeID'].value === 8">
              <mat-form-field style="width: 100%;">
                <mat-label class="field-lable">اختر نقطة الاتصال</mat-label>
                <mat-select formControlName="endPointID" class="field-lable"
                  [required]="approvalPhaseForm.controls['ApprovalTypeID'].value === 8">
                  <mat-option class="field-lable" *ngFor="let postService of externalDataSources_Post" [value]="postService.id">
                    {{ postService.name }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="d-flex align-items-center justify-content-between mt-4 mb-0">
            <button class="btn btn-primary field-lable" type="submit">إضافة <mat-icon>add</mat-icon></button>
          </div>
        </form>
      </div>
      <div class="col-xs-12 col-md-6 " *ngIf="isLoading" style="text-align: center;">
        <br /><br />
        <app-loading-spinner></app-loading-spinner>
      </div>

    </div>
  </div>
</div>